---
title: "p8105_hw3_kg3006"
author: "Kevin Guzman"
date: "2025-10-09"
output: github_document
---

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(broom)
```


## Problem 1 

The graph below demonstrates the probability that there is at least 1 shared birthday in a group of individuals from a group of 2 people to 50 simulated over 10,000 trials. 
```{r, echo=FALSE, message=FALSE, warning=FALSE}
#Writting bithrday loop function
birthday <- function(x) {
  birthday <- sample(1:365, size=x, replace=TRUE)
  
  #check duplicates 
  any(duplicated(birthday))
}

#Defining varibles 
set.seed(123)
group_sizes <- 2:50
n <- 10000

#Simulating birthday problem
results <- sapply(group_sizes, function(x) {
  mean(replicate(n, birthday(x)))
})

#Plot 
plot(group_sizes, results, type = "b",
     xlab = "Group size (n)",
     ylab = "Probability of shared birthday",
     main = "Probability of Shared Birthday by Group Size")
```

As noted in the graph. As the group sizes increase, the probabiliyt of a shared birthday also increases. Interestingly, even though there are 365 possible birthdays. The probability of a shared birthday among a group of 25 people is already over 50% and that of a group of 50 people is nearly 100%! 


## Problem 2 

### Part A 
This figure shows that at mean of 0, the power to detect a differnece is 0.05, as we increased the true mean value, the power to detect a difference also increases and approaches 100% by a true mean value of 4. 
```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Setting fixed design element n = 30, and sigma=5, muu=0
set.seed(123)
n <- 30
sigma <- 5
muu_value <- 0:6
nsim <- 5000

#Creating a function that is easier 
mean_p <- function(mu, n, sigma, nsim) {
  sim_data <- replicate(nsim, {
    x <- rnorm(n, mean = mu, sd = sigma)
    ttest <- t.test(x, mu = 0)
    #Saving in table
    tibble(
      mean = mean(x),
      p_value = ttest$p.value,
      mu = mu)
    }, simplify = FALSE) %>% 
    bind_rows()
}

# Run the simulation 
sim_data <- map_df(muu_value, ~ mean_p(.x, n, sigma, nsim))

# Power Calculation 
power_results <- sim_data %>%
  group_by(mu) %>%
  summarize(power = mean(p_value <0.05), .groups = 'drop')

#Plot 
ggplot(power_results, aes(x = mu, y = power)) +
  geom_line() +
  geom_point() +
  labs(
    x = "True value of μ",
    y = "Power",
    title = "Power by Effect Size"
  ) +
  ylim(0, 1) + 
  theme_minimal()
```

### Part B
The simulated value of mu in our simmulation with 5,000 simulation approximates that of the true value of mu quite well. When you look at only those where the t-test rejected the hypothesis though. You see that, for the smaller subsets the ones that were rejected had means that were far away from the true value. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#Rejected mu 
mu_rejected <- sim_data %>% 
  group_by(mu) %>% 
  summarize(
    true_mu = mean(mean),
    rejected_mu = mean(mean[p_value < 0.05]), 
            .groups = 'drop')
#Second plot

ggplot(mu_rejected, aes(x = mu)) +
  # All samples line
  geom_line(aes(y = true_mu), color = "blue", size = 1.2) +
  geom_point(aes(y = true_mu), color = "blue") +
  
  # Rejected samples line
  geom_line(aes(y = rejected_mu), color = "red", size = 1.2) +
  geom_point(aes(y = rejected_mu), color = "red") +
  
  # 45-degree reference line
  geom_abline(intercept = 0, slope = 1, linetype = "dashed") +
  
  labs(
    x = "True value",
    y = "Average estimatê",
    title = "Average mu For All Samples (blue) vs Rejected Samples (red)"
  ) +
  theme_minimal()
```

## Problem 3 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#Loading Washington Post Homocide Data 
WP <- read.csv(
  "https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv",
  stringsAsFactors = FALSE
)

#Cleaning data a bit
  #reported_date, fixing date   
  WP$reported_date <-as.Date(as.character(WP$reported_date), format="%Y%m%d") 
```

The Washington Post Homicide Data contains information on homicides in the United States from `r min(WP$reported_date)`
 to `r max(WP$reported_date)`. It contains a total of `r nrow(WP)` observations and `r ncol(WP)` variables. Key variables that it contains are the victims name, race, age, sex, city, state, and disposition of the homicide case. 
 
```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Creating city, state variable 
WP <- WP %>%
  mutate(city_state = paste0(city, ", ", state))

```

